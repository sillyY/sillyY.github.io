<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä»Object.definePropertyåˆ°Proxy | sillyY</title>
    <meta name="description" content="Just playing around">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.28ef1fef.css" as="style"><link rel="preload" href="/assets/js/app.8dae8355.js" as="script"><link rel="preload" href="/assets/js/2.dc92909d.js" as="script"><link rel="preload" href="/assets/js/32.8c90a456.js" as="script"><link rel="prefetch" href="/assets/js/10.e98d4025.js"><link rel="prefetch" href="/assets/js/11.5587c763.js"><link rel="prefetch" href="/assets/js/12.2d3c60f5.js"><link rel="prefetch" href="/assets/js/13.eaa7ea73.js"><link rel="prefetch" href="/assets/js/14.f6fe8d5b.js"><link rel="prefetch" href="/assets/js/15.17160c19.js"><link rel="prefetch" href="/assets/js/16.612f97fd.js"><link rel="prefetch" href="/assets/js/17.4ace0302.js"><link rel="prefetch" href="/assets/js/18.6e13a193.js"><link rel="prefetch" href="/assets/js/19.c2c41b36.js"><link rel="prefetch" href="/assets/js/20.86ab84d4.js"><link rel="prefetch" href="/assets/js/21.51b2926e.js"><link rel="prefetch" href="/assets/js/22.68ae5fa7.js"><link rel="prefetch" href="/assets/js/23.46ee807b.js"><link rel="prefetch" href="/assets/js/24.ba851b1c.js"><link rel="prefetch" href="/assets/js/25.04343082.js"><link rel="prefetch" href="/assets/js/26.c3095e35.js"><link rel="prefetch" href="/assets/js/27.a40569d3.js"><link rel="prefetch" href="/assets/js/28.8f598cb4.js"><link rel="prefetch" href="/assets/js/29.715a5b6b.js"><link rel="prefetch" href="/assets/js/3.4df34556.js"><link rel="prefetch" href="/assets/js/30.fe812dba.js"><link rel="prefetch" href="/assets/js/31.f1550050.js"><link rel="prefetch" href="/assets/js/33.9515fed6.js"><link rel="prefetch" href="/assets/js/34.103c5784.js"><link rel="prefetch" href="/assets/js/35.ed96bf70.js"><link rel="prefetch" href="/assets/js/36.03c7586b.js"><link rel="prefetch" href="/assets/js/37.1f6cd2c2.js"><link rel="prefetch" href="/assets/js/38.dbf816f4.js"><link rel="prefetch" href="/assets/js/39.4387a0c9.js"><link rel="prefetch" href="/assets/js/4.8ca31cab.js"><link rel="prefetch" href="/assets/js/40.2830a92f.js"><link rel="prefetch" href="/assets/js/41.66cdba68.js"><link rel="prefetch" href="/assets/js/42.d3e87825.js"><link rel="prefetch" href="/assets/js/5.ed1cff9d.js"><link rel="prefetch" href="/assets/js/6.a180e42e.js"><link rel="prefetch" href="/assets/js/7.101c3ea0.js"><link rel="prefetch" href="/assets/js/8.38b06e0d.js"><link rel="prefetch" href="/assets/js/9.5d56b8fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.28ef1fef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">sillyY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸŒŸåšå®¢</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link router-link-active">å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/backEnd/" class="nav-link">åç«¯</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">å·¥å…·</a></li></ul></div></div><div class="nav-item"><a href="/learn/" class="nav-link">ğŸ“šå­¦ä¹ </a></div><div class="nav-item"><a href="/todo/" class="nav-link">ğŸ’¡Todo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ’»é¡¹ç›®</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://sillyy.cn/TemplateCLI-Extension/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Template
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/ele-vue/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ele-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/diff-dir-file/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  diff-dir-file
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/vuepress-plugin-code-segment/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress-plugin-code-segment
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sillyY" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸŒŸåšå®¢</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontEnd/" class="nav-link router-link-active">å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/backEnd/" class="nav-link">åç«¯</a></li><li class="dropdown-item"><!----> <a href="/tools/" class="nav-link">å·¥å…·</a></li></ul></div></div><div class="nav-item"><a href="/learn/" class="nav-link">ğŸ“šå­¦ä¹ </a></div><div class="nav-item"><a href="/todo/" class="nav-link">ğŸ’¡Todo</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ğŸ’»é¡¹ç›®</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://sillyy.cn/TemplateCLI-Extension/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Template
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/ele-vue/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ele-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/diff-dir-file/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  diff-dir-file
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://sillyy.cn/vuepress-plugin-code-segment/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress-plugin-code-segment
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sillyY" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontEnd/" class="sidebar-link">æ¬¢è¿</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontEnd/vue/from-defineProperty-to-proxy.html" class="active sidebar-link">ä»Object.definePropertyåˆ°Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#object-defineproperty" class="sidebar-link">Object.defineProperty</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#getterä¸setter" class="sidebar-link">Getterä¸Setter</a></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#vue2ä¸­çš„object-defineproperty" class="sidebar-link">vue2ä¸­çš„Object.defineProperty</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#proxy" class="sidebar-link">Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#æ€ä¹ˆç”¨" class="sidebar-link">æ€ä¹ˆç”¨</a></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#vue3ä¸­çš„proxy" class="sidebar-link">vue3ä¸­çš„Proxy</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#object-defineproperty-get-setéƒ¨åˆ†-ä¸proxyåŒºåˆ«" class="sidebar-link">Object.defineProperty(Get/Setéƒ¨åˆ†)ä¸ProxyåŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#ç»“è¯­" class="sidebar-link">ç»“è¯­</a></li><li class="sidebar-sub-header"><a href="/frontEnd/vue/from-defineProperty-to-proxy.html#å‚è€ƒæ–‡çŒ®" class="sidebar-link">å‚è€ƒæ–‡çŒ®</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å°ç¨‹åº</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ‚ç±»</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç½‘ç»œåè®®</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‡½æ•°å¼ç¼–ç¨‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç®—æ³•</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è®¾è®¡æ¨¡å¼</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æºç é˜…è¯»</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ä»object-definepropertyåˆ°proxy"><a href="#ä»object-definepropertyåˆ°proxy" aria-hidden="true" class="header-anchor">#</a> ä»Object.definePropertyåˆ°Proxy</h1> <p>éšç€<em>vue3.0beta</em>ç‰ˆçš„å‘å¸ƒï¼Œ<em>vue</em>å³å°†è¿æ¥æ–°ä¸€è½®çš„æŠ€æœ¯é©æ–°ã€‚å¯¹äºvueæºç  çš„å­¦ä¹ ï¼Œä¹Ÿæˆä¸ºäº†ä¸€ä¸ªä¼˜ç§€çš„vueå·¥ç¨‹å¸ˆå¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†, è€Œ<em>vue</em>ä¸­çš„<em>å“åº”å¼åŸç†</em>æ­£æ˜¯å…¶ä¸­æœ€ä¸»è¦çš„ä¸€éƒ¨åˆ†ã€‚</p> <p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†<em>Object.defineProperty</em>ä¸<em>Proxy</em>çš„åŒºåˆ«ï¼Œä»¥åŠäºŒè€…åœ¨<em>vue</em> ä¸­çš„åº”ç”¨ã€‚ä»¥ä¸‹æ˜¯æœ¬æ–‡çš„æ€ç»´å¯¼å›¾ã€‚</p> <p><img src="/total.png" alt="total"></p> <h2 id="object-defineproperty"><a href="#object-defineproperty" aria-hidden="true" class="header-anchor">#</a> Object.defineProperty</h2> <p><strong><code>Object.defineProperty()</code></strong> æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
</code></pre></div><ul><li><code>obj</code> å®šä¹‰çš„å¯¹è±¡</li> <li><code>prop</code> è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§</li> <li><code>descriptor</code> è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦</li></ul> <p>å±æ€§æè¿°ç¬¦åˆæœ‰<em>configurable</em>ã€<em>enumerable</em>ã€<em>value</em>ã€<em>writeable</em>ã€<em>get</em>ã€<em>set</em>ç­‰æƒ…å†µã€‚</p> <p>è¿™é‡Œæ¯ä¸€ä¸ªéƒ½æœ‰å…¶ç›¸åº”çš„ä½œç”¨ï¼Œä½†æˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨ä¸‹getä¸setè¿™2ä¸ªæè¿°ç¬¦ã€‚</p> <p>å¯¹äºå…¶ä»–çš„å‘¢ï¼Œç•™åˆ°ä¸‹æ¬¡å§ã€‚æœ‰éœ€è¦å¯ä»¥çœ‹çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ä¸Šå…³äºä»–ä»¬çš„æè¿°ã€‚</p> <h3 id="getterä¸setter"><a href="#getterä¸setter" aria-hidden="true" class="header-anchor">#</a> Getterä¸Setter</h3> <p>å—¯ï¼Ÿ æ€ä¹ˆè¿™é‡Œåˆå˜æˆäº†Getterä¸Setterå‘¢ï¼Ÿ</p> <p>å½“å¯¹è±¡çš„å±æ€§æ‹¥æœ‰è¿™ä¸¤ä¸ª<em>get</em>ä¸<em>set</em>ç‰¹æ€§æ—¶ï¼Œé‚£åœ¨è®¿é—®å±æ€§æˆ–è€…å†™å…¥å±æ€§å€¼æ—¶ï¼Œå¯¹è¿”å›å€¼åšé™„åŠ çš„æ“ä½œã€‚è€Œè¿™ä¸ªæ“ä½œå°±æ˜¯<em>getter/setter</em>å‡½æ•°ã€‚</p> <p>è¿™é‡Œç¡®å®æœ‰ç‚¹çº ç»“ï¼Œæ„Ÿè§‰å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æ–¹ä¾¿ç†è§£</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token comment">// ä¸‹é¢ä¼ªä»£ç ï¼Œæ–¹ä¾¿ç†è§£</span>
  <span class="token comment">/*
  a: {
  	// è¯»å–ï¼Œ å¦‚ obj.a
    get: function getter() {},
    // è®¾å€¼  å¦‚ obj.a = 2
    set: function setter(val) {}
  }
  */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å…¶å®å·®ä¸å¤šå°±æ˜¯è¿™ç§æ¦‚å¿µï¼Œè‹¥æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</p> <p>å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´äº†ï¼Œå¼€å§‹æ­£é¢˜å§ã€‚</p> <img src="/code.png" alt="code" style="zoom:100%;"> <p>åœ¨getterå‡½æ•°é‡Œæ‰§è¡Œ*<code>console.log('è·å–nameå€¼')</code><em>ï¼Œå¹¶æ‰§è¡Œ</em><code>this._name</code>*ã€‚</p> <p>åœ¨setterå‡½æ•°é‡Œæ‰§è¡Œ*<code>console.log('è®¾ç½®nameå€¼')</code><em>ï¼Œå¹¶æ‰§è¡Œ</em><code>this._name = val</code>*ã€‚</p> <p>ä¹Ÿå°±æ˜¯:</p> <ul><li>è·å–æ•°æ®æ—¶ï¼Œè§¦å‘<em>getterå‡½æ•°</em>ã€‚</li> <li>è®¾ç½®æ•°æ®æ—¶ï¼Œè§¦å‘<em>setterå‡½æ•°</em>ã€‚</li></ul> <blockquote><p>å½“ä½¿ç”¨getteræˆ–è€…setæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨valueå’Œwritableæè¿°ç¬¦, å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote> <p>å¯¹äºè¿™ä¸ªæ€è·¯ï¼Œå“åº”å¼ä¸ä¹Ÿæ˜¯è¿™æ ·å—ï¼Ÿè·å–æ•°æ®æ—¶ï¼Œæ”¶é›†ä¾èµ–ï¼Œä¿®æ”¹è¿™ä¸ªæ•°æ®æ—¶ï¼Œæ‰§è¡Œè¿™äº›ä¾èµ–ã€‚</p> <p>æåˆ°å“åº”å¼ï¼Œè‡ªç„¶å°±æƒ³èµ·æ¥Vueï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹vue2æ˜¯æ€ä¹ˆå®ç°çš„å‘¢</p> <h3 id="vue2ä¸­çš„object-defineproperty"><a href="#vue2ä¸­çš„object-defineproperty" aria-hidden="true" class="header-anchor">#</a> vue2ä¸­çš„Object.defineProperty</h3> <p><img src="/data.png" alt="data"></p> <p>åˆå§‹åŒ–é˜¶æ®µä¼šéå†dataä¸­çš„å€¼ï¼Œå°†dataä¸­æ¯ä¸ªå€¼é€šè¿‡<em>defineReactiveå‡½æ•°</em>å˜ä¸ºå“åº”å¼æ•°æ®ï¼Œåœ¨get ä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨setterä¸­æ‰§è¡Œæ¶ˆæ¯é€šçŸ¥ï¼Œé€šçŸ¥æ‰€æœ‰ä¾èµ–ï¼ˆwatcherå®ä¾‹ï¼‰ï¼Œä½¿å…¶ç›¸å…³è”çš„ç»„ä»¶å¾—åˆ°æ›´æ–° ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ç²¾ç®€ç‰ˆdefineReactive</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ”¶é›†ä¾èµ–</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€šçŸ¥ä¾èµ–</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªdepï¼Œdepæ˜¯å•¥å‘¢ï¼Ÿ</p> <p>æˆ‘ä»¬éƒ½çŸ¥é“dataä¸­çš„æ•°æ®ï¼Œéƒ½å¯èƒ½è¢«å¤šä¸ªåœ°æ–¹å¼•ç”¨ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„*â€œä¾èµ–â€*ã€‚</p> <p>å½“ä¾èµ–å¢å¤šï¼Œå°±ä¸å¾—ä¸è€ƒè™‘æ€ä¹ˆå»å®‰æ”¾è¿™ä¸ªä¾èµ–äº†ï¼Œä¹Ÿå°±å¼•å…¥äº†ä¾èµ–ç®¡ç†å™¨Depçš„æ¦‚å¿µã€‚ç®¡ç†å™¨éœ€è¦å»æ–°å¢(addSub)ï¼Œåˆ é™¤(removeSub)ã€æ”¶é›†ç›¸å…³ä¾èµ–(depend)ï¼Œé€šçŸ¥(notify)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">addSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">removeSub</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  ç§»é™¤ä¾èµ–</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ·»åŠ ä¸€ä¸ªä¾èµ– </span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œä¹Ÿå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ<em>ä¾èµ–</em>åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p> <p>ä¾èµ–ä»£è¡¨æŸä¸ªç»„ä»¶è¿ç”¨äº†æŸæ¡æ•°æ®ï¼Œä½†è¿™ä¸ªæœºåˆ¶ä¸èƒ½æ”¾åœ¨ç»„ä»¶é‡Œå»å®ç°ï¼Œå°†å…¶æŠ½ç¦»å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯å½¢æˆäº†ç°åœ¨çš„Watcherç±»ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span>expOrFn<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>getter <span class="token operator">=</span> <span class="token function">parsePath</span><span class="token punctuation">(</span>expOrFn<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     	Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
      Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span>
    <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> oldValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ†æWatcherç±»å‹</p> <ul><li>å®ä¾‹åŒ–<em>Watchç±»</em>ï¼Œ ä¼šè°ƒç”¨*<code>this.get()</code>*</li> <li>åœ¨<em>getå‡½æ•°</em>ä¸­
<ul><li>*<code>Dep.target = this</code>*ä¼šå°†å…¶èµ‹å€¼ç»™Depçš„é™æ€å±æ€§ï¼Œä¿è¯äº†åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªwatcherå®ä¾‹</li> <li><em><code>let value = this.getter.call(vm, vm)</code><em>è°ƒç”¨</em>getteræ–¹æ³•</em>è·å–åˆ°æ•°æ®å€¼ï¼Œä½†åœ¨<em>Object.defineProperty</em>ä¸­çš„getterå‡½æ•°é‡Œè®¾ç½®äº†ä¾èµ–æ”¶é›†ï¼Œæ‰€ä»¥æ‰§è¡Œè¿™ä¸ªè¯­å¥æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¯¥æ•°æ®çš„ç›¸å…³ä¾èµ–çš„æ”¶é›†ã€‚</li> <li><em><code>Dep.target = undefined;</code><em>æ”¶é›†å®Œä¾èµ–åï¼Œé‡Šæ”¾</em>Dep.target</em>ï¼Œä¿è¯åç»­åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªwatcherå®ä¾‹ã€‚</li></ul></li> <li>å½“æ•°æ®å˜åŒ–æ—¶ï¼Œ
<ul><li>ä¼šè°ƒç”¨æ•°æ®çš„<em>setterå‡½æ•°</em>ï¼Œåœ¨<em>setter</em>ä¸­è°ƒç”¨*<code>dep.notify()</code>*</li> <li><em><code>dep.notify()</code><em>ä¼šéå†</em>subs</em>ï¼Œä¹Ÿå°±æ˜¯éå†æ‰€æœ‰ä¾èµ–ï¼Œå¹¶è°ƒç”¨ä¾èµ–è‡ªèº«(Watcherå®ä¾‹)çš„<em>update</em>æ–¹æ³•,</li> <li>*<code>update()</code>*ä¸­è°ƒç”¨æ•°æ®å˜åŒ–çš„æ›´æ–°å›è°ƒå‡½æ•°ï¼Œä»è€Œæ›´æ–°è§†å›¾ã€‚</li></ul></li></ul> <p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œç‰¹ç”»å‡ºå…³ç³»æµç¨‹å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p> <img src="/vue2.png" alt="vue2" style="zoom:100%;"> <p>ä»¥ä¸Šï¼Œå°±æ•´ç†å‡ºäº†Object.definePropertyåœ¨Vue2ä¸­çš„åº”ç”¨ã€‚</p> <p>ä½†<em>Object.defineProperty</em>å¹¶ä¸æ˜¯å®Œç¾çš„ï¼Œå®ƒå­˜åœ¨ ä¸€äº›è‡ªèº«çš„é—®é¢˜ï¼Œä¸‹é¢å°±åˆ—ä¸¾ä¸‹<em>Object.defineProperty</em>åœ¨vueä¸­çš„ç¼ºé™·</p> <ul><li><p><em>Object.defineProperty</em>æ— æ³•â€œ<em>å‹å–„åœ°</em>â€ç›‘å¬æ•°ç»„å˜åŒ–ã€‚(å…·ä½“å¯å‚è€ƒ<a href="https://segmentfault.com/a/1190000015783546" target="_blank" rel="noopener noreferrer">Vueä¸ºä»€ä¹ˆä¸èƒ½æ£€æµ‹æ•°ç»„å˜åŠ¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p> <p>vueé€šè¿‡é‡å†™*<code>push() pop() shift() unshift() splice() sort() reverse()</code>* 8ä¸ªæ–¹æ³•ï¼Œæ¥å®ç°vueæ•°ç»„çš„ç›‘å¬ï¼Œä½†å…¶ä»–çš„æ–¹æ³•å°±ä¸èƒ½æœ‰æ•ˆçš„å®ç°ç›‘å¬ã€‚</p></li> <li><p><em>Object.defineProperty</em>æ— æ³•åŠ«æŒæ•´ä¸ªå¯¹è±¡ã€‚</p> <p>å› æ­¤éœ€è¦éå†å¯¹è±¡ï¼Œå¯¹å…¶æ¯ä¸ªå±æ€§è¿›è¡Œç›‘å¬ã€‚å¦‚æœå¯¹è±¡å±‚çº§å¤æ‚ï¼Œæ“ä½œä¸æ€§èƒ½éƒ½ä¼šå¾—åˆ°ä¸€å®šæµªè´¹ã€‚</p></li></ul> <blockquote><p>å…³äºObject.definePropertyä¸èƒ½ç›‘å¬æ•°ç»„é•¿åº¦çš„è§£é‡Šï¼š</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">MDN-Object.defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ä¸­çš„configurableä¸­æ˜ç¡®æ ‡å‡ºï¼šå½“ä¸”ä»…å½“è¯¥å±æ€§çš„ <code>configurable</code> é”®å€¼ä¸º <code>true</code> æ—¶ï¼Œè¯¥å±æ€§çš„æè¿°ç¬¦æ‰èƒ½å¤Ÿè¢«æ”¹å˜ï¼ŒåŒæ—¶è¯¥å±æ€§ä¹Ÿèƒ½ä»å¯¹åº”çš„å¯¹è±¡ä¸Šè¢«åˆ é™¤ã€‚</p> <p>è€Œæ•°ç»„çš„lengthçš„configurableä¸ºfalseï¼Œå¹¶ä¸”ç¦æ­¢ä¿®æ”¹ï¼Œå¼ºè¡Œä¿®æ”¹ä¼šæŠ›å‡º*â€œVM305:1 Uncaught TypeError: Cannot redefine property: lengthâ€*çš„å¼‚å¸¸ã€‚</p></blockquote> <h2 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> Proxy</h2> <p><strong>Proxy</strong> å¯¹è±¡ç”¨äºå®šä¹‰åŸºæœ¬æ“ä½œçš„è‡ªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
</code></pre></div><ul><li><code>target</code> è¦ä½¿ç”¨ <code>Proxy</code> åŒ…è£…çš„ç›®æ ‡å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰ã€‚</li> <li><code>handler</code> ä¸€ä¸ªé€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œå„å±æ€§ä¸­çš„å‡½æ•°åˆ†åˆ«å®šä¹‰äº†åœ¨æ‰§è¡Œå„ç§æ“ä½œæ—¶ä»£ç† <code>p</code> çš„è¡Œä¸ºã€‚</li></ul> <h3 id="æ€ä¹ˆç”¨"><a href="#æ€ä¹ˆç”¨" aria-hidden="true" class="header-anchor">#</a> æ€ä¹ˆç”¨</h3> <p><img src="/proxy.png" alt="proxy"></p> <p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºæ¥<code>Proxy</code>å¯ä»¥å‹å¥½çš„ä¿®å¤<code>Object.defineProperty</code>ä¸­çš„ç¼ºé™·ã€‚</p> <p>é™¤äº†ä¿®å¤é—®é¢˜å¤–ï¼Œ<code>Proxy</code>å¯¹è±¡ï¼Œè¿˜æä¾› äº†æ–°çš„åŠ«æŒæ–¹æ¡ˆã€‚</p> <ul><li><strong><code>handler.apply()</code></strong>  ç”¨äºæ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€‚</li> <li><strong><code>handler.construct()</code></strong> ç”¨äºæ‹¦æˆª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new" target="_blank" rel="noopener noreferrer"><code>new</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å‘½ä»¤ã€‚</li> <li><strong><code>handler.defineProperty()</code></strong> ç”¨äºæ‹¦æˆªå¯¹å¯¹è±¡çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer"><code>Object.defineProperty()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ“ä½œã€‚</li> <li><strong><code>handler.deleteProperty()</code></strong> ç”¨äºæ‹¦æˆªå¯¹å¯¹è±¡å±æ€§çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/delete" target="_blank" rel="noopener noreferrer"><code>delete</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ“ä½œã€‚</li> <li><strong><code>handler.get()</code></strong> ç”¨äºæ‹¦æˆªå¯¹è±¡çš„è¯»å–å±æ€§æ“ä½œã€‚</li> <li><strong><code>handler.getOwnPropertyDescriptor()</code></strong> ç”¨äºæ‹¦æˆª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor" target="_blank" rel="noopener noreferrer"><code>Object.getOwnPropertyDescriptor()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ã€‚</li> <li><strong><code>handler.getPrototypeOf()</code></strong> ç”¨äºæ‹¦æˆªè·å–å¯¹è±¡åŸå‹ã€‚</li> <li><strong><code>handler.has()</code></strong> ç”¨äºæ‹¦æˆª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in" target="_blank" rel="noopener noreferrer"><code>in</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ“ä½œç¬¦ã€‚</li> <li><strong><code>handler.isExtensible()</code></strong> ç”¨äºæ‹¦æˆªå¯¹å¯¹è±¡çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/isExtensible" target="_blank" rel="noopener noreferrer">Object.isExtensible()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</li> <li><strong><code>handler.ownKeys()</code></strong> ç”¨äºæ‹¦æˆª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect/ownKeys" target="_blank" rel="noopener noreferrer"><code>Reflect.ownKeys()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</li> <li><strong><code>handler.preventExtensions()</code></strong> ç”¨äºæ‹¦æˆª<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/preventExtensions" target="_blank" rel="noopener noreferrer"><code>Object.preventExtensions()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</li> <li><strong><code>handler.set()</code></strong> ç”¨äºæ‹¦æˆªå¯¹è±¡çš„è®¾ç½®å±æ€§æ“ä½œã€‚</li> <li><strong><code>handler.setPrototypeOf()</code></strong> ç”¨äºæ‹¦æˆª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf" target="_blank" rel="noopener noreferrer"><code>Object.setPrototypeOf()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</li></ul> <p>å¦å¤–åœ¨è¿™é‡Œï¼Œå‡ºç°äº†*<code>Reflect</code>*è¿™ä¸ªå¯¹è±¡ã€‚<code>Reflect</code>å¯¹è±¡ä¸<code>Proxy</code>å¯¹è±¡ä¸€æ ·ï¼Œæ˜¯ES6ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–°APIã€‚(PS:æŠ½ç¦»<code>object</code>ä¸­çš„è¯­è¨€å†…éƒ¨æ–¹æ³•ï¼ˆæ¯”å¦‚<code>Object.defineProperty</code>ï¼‰ï¼Œå°†å…¶æ”¾åˆ°<code>Reflect</code>å¯¹è±¡ä¸Šï¼Œæœªæ¥çš„æ–°æ–¹æ³•å°†åªéƒ¨ç½²åˆ°<code>Reflect</code>å¯¹è±¡ä¸Šã€‚)</p> <h3 id="vue3ä¸­çš„proxy"><a href="#vue3ä¸­çš„proxy" aria-hidden="true" class="header-anchor">#</a> vue3ä¸­çš„Proxy</h3> <p>è™½è¯´<em>vue3Betaç‰ˆ</em>å‘å¸ƒäº†, ä½†çœŸæ­£å»å†™vue3çš„äººä¸ä¼šé‚£ä¹ˆå¤šï¼Œé‚£å¥½ï¼Œå…ˆä¸Šå›¾ã€‚</p> <p><img src="/vue3.png" alt="vue3"></p> <p>è¿™ç§ç§°ä¹‹ä¸º<a href="https://vue-composition-api-rfc.netlify.app/#summary" target="_blank" rel="noopener noreferrer">Composition API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œæœªæ¥å°†ä¸vue2ä¸­<em>Option API</em>(PSï¼šå½“å‰ä½¿ç”¨)æºæ‰‹å…±è¿›é€€ã€‚</p> <p>å¯¹äº<a href="https://vue-composition-api-rfc.netlify.app/#summary" target="_blank" rel="noopener noreferrer">Composition API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»åˆå§‹åŒ–Proxyï¼Œgetä¾èµ–æ”¶é›†ï¼Œsetè§¦å‘ä¾èµ–æ›´æ–°ç­‰è§’åº¦ æ¥çœ‹ã€‚</p> <h5 id="åˆå§‹åŒ–proxy"><a href="#åˆå§‹åŒ–proxy" aria-hidden="true" class="header-anchor">#</a> åˆå§‹åŒ–Proxy</h5> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> rawToReactive <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reactiveToRaw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">let</span> observed <span class="token operator">=</span> rawToReactive<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>observed <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reactiveToRaw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handlers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  rawToReactive<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> observed<span class="token punctuation">)</span><span class="token punctuation">;</span>
  reactiveToRaw<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>observed<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><p><em><code>rawToReactive</code><em>ç”¨äºä¿å­˜</em>åŸå§‹æ•°æ®</em> -<em>å“åº”æ•°æ®</em>çš„é”®å€¼å¯¹é›†åˆï¼Œ<em><code>reactiveToRaw</code><em>ç”¨äºä¿å­˜</em>å“åº”æ•°æ®</em>-<em>åŸå§‹æ•°æ®</em>çš„é”®å€¼å¯¹é›†åˆã€‚</p> <p>è¿™ä¸¤ä¸ªé›†åˆç”¨äºä¿è¯<em>åŸå§‹æ•°æ®</em>è½¬æˆ<em>å“åº”å¼æ•°æ®</em>åªè¢«è½¬æ¢ä¸€æ¬¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<em>åŸå§‹æ•°æ®</em>å¾—åˆ°<em>å“åº”æ•°æ®</em>ï¼Œé€šè¿‡<em>å“åº”æ•°æ®</em>å¾—åˆ°<em>åŸå§‹æ•°æ®</em>ã€‚</p></li> <li><p><code>reactive</code>ä¸­ä» <em><code>rawToReactive</code><em>å–ç›®æ ‡å€¼ï¼Œåˆ¤æ–­æ˜¯å¦å·²è¢«è½¬æ¢æˆ</em>å“åº”å¼æ•°æ®</em>ï¼Œä»*<code>reactiveToRaw</code>*åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®æ ‡å€¼ã€‚</p></li> <li><p><em><code>observed = new Proxy(target, handlers);</code><em>è¿™é‡Œå°†ç›®æ ‡å€¼è½¬æˆ</em>Proxyå¯¹è±¡</em>ï¼Œå³<em>å“åº”å¼æ•°æ®</em>ã€‚ï¼ˆPSï¼š<em>handlers</em>è§åæ–‡ï¼‰</p></li> <li><p>å°†é”®å€¼å¯¹ä¿å­˜åˆ°*<code>rawToReactive</code><em>å’Œ</em><code>reactiveToRaw</code>ä¸­ï¼Œç”¨äºåç»­ä½¿ç”¨ã€‚</p></li> <li><p>è¿”å›å“åº”å¼æ•°æ® ã€‚</p></li></ul> <h5 id="handlersè¿‡ç¨‹"><a href="#handlersè¿‡ç¨‹" aria-hidden="true" class="header-anchor">#</a> handlersè¿‡ç¨‹</h5> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> Handlers<span class="token punctuation">:</span> ProxyHandler<span class="token operator">&lt;</span>object<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> object<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span> receiver<span class="token punctuation">:</span> object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">track</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token string">'get'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">:</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token keyword">set</span><span class="token punctuation">(</span>
    <span class="token parameter">target<span class="token punctuation">:</span> object<span class="token punctuation">,</span>
    key<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token builtin">unknown</span><span class="token punctuation">,</span>
    receiver<span class="token punctuation">:</span> object</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oldValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> hadKey <span class="token operator">=</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Reflect<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hadKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token string">'add'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> oldValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token string">'set'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol><li>*<code>get</code>*å‡½æ•°è¿‡ç¨‹
<ul><li>*<code>const res = Reflect.get(target, key, receiver)</code>*è·å–ç›®æ ‡å±æ€§å€¼</li> <li>*<code>track(target, 'get', key)</code>*è¿½è¸ªç›®æ ‡ç›¸å…³å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰</li> <li>åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡
<ul><li>æ˜¯å¯¹è±¡ï¼Œé€šè¿‡*<code>reactive(res)</code>*ä¿æŒæ·±åº¦å¤„ç†</li> <li>è¿”å›res</li></ul></li></ul></li> <li>*<code>set</code>*å‡½æ•°è¿‡ç¨‹
<ul><li>*<code>const oldValue = target[key];</code>*è·å–æ—§å€¼</li> <li>*<code>Reflect.set(target, key, value, receiver)</code>*è®¾ç½®æ–°å€¼</li> <li>*<code>const hadKey = hasOwn(target, key)</code>*åˆ¤æ–­ç›®æ ‡ä¸­æ˜¯å¦å­˜åœ¨è¯¥å±æ€§
<ul><li>ä¸å­˜åœ¨ï¼Œé€šè¿‡*<code>trigger(target, 'add', key, value)</code><em>è§¦å‘</em>â€œæ–°å¢å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰â€<em>æ“ä½œï¼Œå¹¶æ‰§è¡Œ</em>â€œæ‰§è¡Œå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰â€*æ“ä½œã€‚</li> <li>å¦‚æœ*<code>value !== oldValue</code><em>ï¼Œé€šè¿‡</em><code>trigger(target, 'set', key, value, oldValue)</code><em>è§¦å‘</em>â€œæ‰§è¡Œå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰â€*æ“ä½œã€‚</li></ul></li></ul></li></ol> <h5 id="trackå‡½æ•°ã€è¿½è¸ªå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘ä¸triggerå‡½æ•°ã€è§¦å‘å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘"><a href="#trackå‡½æ•°ã€è¿½è¸ªå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘ä¸triggerå‡½æ•°ã€è§¦å‘å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘" aria-hidden="true" class="header-anchor">#</a> trackå‡½æ•°ã€è¿½è¸ªå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘ä¸triggerå‡½æ•°ã€è§¦å‘å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">track</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> type<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> depsMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">(</span>depsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> dep <span class="token operator">=</span> depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    depsMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dep<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>activeEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    activeEffect<span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> type<span class="token punctuation">,</span> key<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> oldTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> depsMap <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>depsMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> effects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> computedRunners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  depsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effect</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>effect <span class="token operator">!==</span> activeEffect <span class="token operator">||</span> <span class="token operator">!</span>shouldTrack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>effect<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        computedRunners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        effects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  computedRunners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effect</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  effects<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">effect</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>trackè¿‡ç¨‹</li></ol> <ul><li><p><em><code>let depsMap = targetMap.get(target)</code><em>è·å–å½“å‰ç›®æ ‡çš„</em>depsMap</em>(<em>ä¾èµ–é›†åˆ</em>)ï¼Œä¸å­˜åœ¨åˆ™æ–°å»º</p></li> <li><p><em><code>let dep = depsMap.get(key)</code><em>è·å–å½“å‰</em>key</em>ï¼ˆ<em>å±æ€§</em>ï¼‰ä¸‹çš„ä¾èµ–ï¼Œä¸å­˜åœ¨åˆ™æ–°å»º</p></li> <li><p><em><code>!dep.has(activeEffect)</code><em>åˆ¤æ–­ä¾èµ–ä¸­æ˜¯å¦å­˜åœ¨</em>activeEffect</em>[<em>æ´»è·ƒå‰¯ä½œç”¨(ä¾èµ–)</em>], ä¸å­˜åœ¨åˆ™æ”¶é›†è¯¥ä¾èµ–</p> <blockquote><p>æ‰€æœ‰çš„effectéƒ½ä¼šå­˜å‚¨äºeffectStackæ ˆä¸­ï¼ŒactiveEffectåˆ™ä¸ºæœ€ä¸Šå±‚çš„æ•°æ®ã€‚ç”¨äºä¿è¯å½“å‰æ´»è·ƒå‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰åªæœ‰ä¸€ä¸ªï¼Œç±»ä¼¼äºvue2ä¸­çš„Dep.targetã€‚</p></blockquote></li></ul> <ol start="2"><li><p>triggerè¿‡ç¨‹</p> <ul><li><em><code>const depsMap = targetMap.get(target)</code><em>è·å–å½“å‰ç›®æ ‡çš„</em>depsMap</em>(<em>ä¾èµ–é›†åˆ</em>)ï¼Œä¸å­˜åœ¨åˆ™è¿”å›ï¼Œè¡¨ç¤ºä¸å­˜åœ¨ä¾èµ–</li> <li>*<code>const effects = new Set()</code><em>æ–°å»ºä¸€ä¸ªeffectsé›†åˆï¼Œ</em><code>const computedRunners = new Set();</code>*æ–°å»ºä¸€ä¸ªè®¡ç®—å±æ€§é›†åˆ</li> <li><em><code>depsMap.get(key).forEach()</code></em> éå†å½“å‰keyå€¼çš„æ‰€æœ‰ä¾èµ–
<ul><li>*<code>effect !== activeEffect || !shouldTrack</code><em>åˆ¤æ–­effectï¼ˆå‰¯ä½œç”¨ï¼‰<em>æ˜¯å¦ä¸º</em>activeEffect</em>ï¼ˆPSï¼šé¿å…äºŒæ¬¡å¤„ç†ï¼‰ï¼Œå¹¶ä¸”ä¸å¯è¢«è¿½è¸ª</li> <li><em><code>effect.options.computed</code><em>åˆ¤æ–­æ˜¯å¦æ˜¯</em>computed</em>ä½¿ç”¨ï¼Œæ˜¯åˆ™å°†<em>effectã€å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘<em>æ·»åŠ åˆ°</em>computedRunners</em>ï¼Œå¦åˆ™å°†<em>effectã€å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰ã€‘<em>æ·»åŠ åˆ°</em>computedRunners</em></li></ul></li> <li>éå†<em>computedRunners</em>å’Œ<em>effects</em>ï¼Œå¹¶æ‰§è¡Œæ¯ä¸ª<em>å‰¯ä½œç”¨ï¼ˆä¾èµ–ï¼‰</em></li></ul></li></ol> <blockquote><p>ä»€ä¹ˆæ˜¯Effect(å‰¯ä½œç”¨)?</p> <p>ä¸€ä¸ªå‡½æ•°æ‰§è¡Œ äº†æŸäº›ä¸è‡ªèº«è¿”å›å€¼æ— å…³çš„äº‹ã€‚</p> <p>å¯¹Vueè€Œè¨€ï¼Œä¾èµ–äºè¿™æ¡æ•°æ®çš„å€¼ï¼Œ æ‰§è¡Œeffectæ—¶ï¼Œæ€»ä¼šå¯¹è¿™ä¸ªå€¼æ‰§è¡ŒæŸä¸ªæ“ä½œï¼Œå¯¼è‡´Effectå¹¶ä¸æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚</p></blockquote> <p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œç‰¹ç”»å‡ºå…³ç³»æµç¨‹å›¾ï¼Œå¦‚ä¸‹å›¾ï¼š</p> <p><img src="/proxy-reactivity.png" alt="reactivity"></p> <h2 id="object-defineproperty-get-setéƒ¨åˆ†-ä¸proxyåŒºåˆ«"><a href="#object-defineproperty-get-setéƒ¨åˆ†-ä¸proxyåŒºåˆ«" aria-hidden="true" class="header-anchor">#</a> Object.defineProperty(Get/Setéƒ¨åˆ†)ä¸ProxyåŒºåˆ«</h2> <img src="/differences.png" alt="differences" style="zoom:200%;"> <p><em>Proxy</em>è™½ç„¶æ”¯æŒäº†<em>Object.defineProperty</em>ä¸Šä¸æ”¯æŒçš„é—®é¢˜ï¼Œä½†å®ƒä¸æ”¯æŒIEã€‚è€Œ<em>Vue</em>ä¹Ÿå¯¹å…¶åšäº†å…¼å®¹æ€§å¤„ç†ï¼Œæ”¯æŒProxyçš„æƒ…å†µä¸‹ä½¿ç”¨Proxyï¼Œè€ŒIEä¸­ä»å°†ç»§ç»­ä½¿ç”¨<em>Object.defineProperty</em>ã€‚</p> <h2 id="ç»“è¯­"><a href="#ç»“è¯­" aria-hidden="true" class="header-anchor">#</a> ç»“è¯­</h2> <p>éšç€<em>Vue3Betaç‰ˆ</em>çš„å‘å¸ƒï¼Œ<em>Proxy</em>å¿…å°†å¾—åˆ°æå¤§çš„æ¨å¹¿ã€‚<em>Proxy</em>è™½å¥½ï¼Œä½†åˆ«â€œä¸Šå¤´â€ï¼Œè€ƒè™‘å¥½å…¼å®¹æ€§é—®é¢˜ã€‚æ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œåˆç†é€‰æ‹©<em>Object.defineProperty</em>æˆ–<em>Proxy</em>æ‰æ˜¯â€œä¸Šä¸Šä¹‹ç­–â€ã€‚</p> <h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" aria-hidden="true" class="header-anchor">#</a> å‚è€ƒæ–‡çŒ®</h2> <ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer">MDN-Object.defineProperty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">MDN-Proxy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank" rel="noopener noreferrer">MDN-Reflect<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://segmentfault.com/a/1190000015783546" target="_blank" rel="noopener noreferrer">Vueä¸ºä»€ä¹ˆä¸èƒ½æ£€æµ‹æ•°ç»„å˜åŠ¨<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">2020-5-1 17:51:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/frontEnd/react/hook-in-project.html" class="prev">
          React Hookåœ¨é¡¹ç›®
        </a></span> <span class="next"><a href="/frontEnd/mp/Data-Communication.html">
          å°ç¨‹åºæ•°æ®é€šä¿¡
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8dae8355.js" defer></script><script src="/assets/js/2.dc92909d.js" defer></script><script src="/assets/js/32.8c90a456.js" defer></script>
  </body>
</html>
